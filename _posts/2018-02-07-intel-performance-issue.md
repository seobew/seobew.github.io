## 인텔 성능저하 이슈

### 배경

최근 인텔의 CPU에서 보안 문제가 발견되었다. 그로인해 CPU의 메모리에서 데이터가 줄줄 새고 있었고, 하드웨어 문제이기 때문에 소프트웨어 기술로 해결할 수 도 없었다. 인텔의 CPU를 사용하고 있는 여러 os별로 보안 패치를 제공하였고, 그 패치를 진행하였을 때 문제가 됐던 CPU 성능이 최대 30%까지 감소한다는 것이다.

### 문제점

가장 큰 문제는 하드웨어 아키텍쳐 및 커널의 문제이기 때문에 공격자가 해당 취약점을 이용해 공격할 경우, **암호화나 백신으로도 막을 수가 없다는 것**이다.



###원인

> 인텔의 CPU 보안 문제의 원인은 구글에서 발견한 두가지 버그이다.

두 버그는 각각 **멜트다운(Meltdown)**과 **스펙터(Spectre)**이다.



##### # 멜트다운

  멜트다운이란 인텔 CPU의 치명적인 보안 결함을 이용해 CPU가 처리하고 있는 응용 프로그램 속 데이터를 낱낱이 훔쳐볼 수 있는 버그이다. 여기서 치명적인 보안 결함은 **비순차적 명령어 처리(OoOE)**기술의 버그를 악용한 보안 결함을 말한다. 멜트다운을 이용하면 보안을 위해 응용 프로그램이 CPU의 캐시 메모리에 접근하지 못했던 기존 하드웨어 보안 구조가 통째로 무너진다. 멜트다운 버그를 이용하면 해커가 악의를 가지고 만든 응용 프로그램(해킹 프로그램)이 사용자의 시스템 메모리에 바로 접근할 수 있게 된다. **중요한 것**은 하드웨어 아키텍쳐 및 커널의 문제이기 때문에, 공격자가 해당 취약점을 이용해 공격할 경우 **암호화나 백신으로도 막을 수가 없다는 것**. 이런 문제를 해결하기 위해서 인텔은 각 OS별로 패치를 통해 문제가 되는 비순차적 명령어 처리를 비활성화하게 하였고, 이로인해 성능이 최대 30%까지 하락하게 된다.



> **참고**
>
> 비순차적 명령어 처리는 현대 CPU 기술의 핵심으로, 특정 작업이 지연됨에 따라 낭비될 수 있는 명렁 사이클을 이용하기 위한 방식이다. 말 그대로 명령어를 순서대로 처리하지 않는다.
>
>  좋은 예시가 있어서 블로그에서 가져왔다. (https://bluekms21.gitbooks.io/femp/03_OoOE.html)
>
> ```{.javascript}
> var c = B;
> var d = A;
> ```
>
> 1. 순차적 처리
>    1. 값 B를 캐시에서 찾음
>    2. 캐시 미스가 발생하고 값 B를 메모리에서 읽어 옴
>    3. 값 c를 할당한 뒤, 메모리에서 읽어 온 값 B로 초기화 (이 과정에서 값 A가 캐시에서 사라짐)
>    4. 값 A를 캐시에서 찾음
>    5. 캐시 미스가 발생하고 값 A를 메모리에서 읽어 옴
>    6. 값 d를 할당한 뒤, 메모리에서 읽어 온 값 A로 초기화
> 2. 비순차적 처리
>    1. 값 B가 필요한 코드를 만났지만 캐시 미스라 일단 대기
>    2. 값 A가 필요한 코드를 만났고 캐시 히트
>    3. 값 d를 할당한 뒤, 캐시 히트한 A로 초기화
>    4. 값 B를 메모리에성 읽어 옴
>    5. 값 c를 할당한 뒤, 메모리에서 읽어 온 값 B로 초기화
>
> 답은 당연히 2번이다. 순차적으로 처리하였을 경우라면 두 번의 메모리 IO가 발생하지만 순서를 바꾸는 것만으로 한번에 해결할 수 있다.



##### # 스펙터

  스펙터는 CPU 속에 담겨있는 수 많은 명령어에서 일어나는 버그를 악용한 보안 취약점이다. 이 버그를 이용하면 해킹 프로그램이 다른 응용 프로그램이 담긴 메모리 내부를 들여다볼 수 있게 된다. 멜트다운처럼 보안 구조가 통째로 무너지는 것은 아니지만, 응용 프로그램이 처리하고 있는 데이터 가운데 일부가 해커들에게 노출 될 수 있다. 스펙터는 어떤 상황에서 어떤 명령어를 이용해 버그가 일어나고, 이를 해결하기 위해 어떤 대응을 해야하는지 추적하기 매우 어렵다. 이 버그는  인텔 뿐만 아니라 AMD, ARM에서도 나타나고 있다. 따라서, 안드로이드나 iOS 디바이스에 사용되는 ARM 프로세서도 공격할 수 있다. 즉 **스마트폰이나 태블릿 등의 모바일 디바이스**에서 사용자의 데이터를 유출할 수 있다는 것이다. 스펙터 버그 또한 **스펙터 취약점 또한 하드웨어 구조적 결함이라 업데이트같은 소프트웨어적 미봉책으로는 사실상 완전히 막을 수 없다.** 스펙터 버그는 수십년간 사용된 프로세서 설계에 존재하는 결함이기 때문이다. 멜트다운 버그가 긴급한 위기인 반면에, 스펙터 버그는 모든 고성능 프로세서에 영향을 끼칠 수 있으며, 성능에 중점을 둔 설계가 이러한 버그에 취약하게 만들었다고 한다. 즉, 성능과 보안을 모두 얻으려던 업계의 갈망이 불가능하다는 것을 보여주는 사례가 스펙터 버그이며 새로운 설계의 프로세서가 나오기 전까지 존재할 것이라고 한다.



> 모바일 관련해서는 http://www.itworld.co.kr/news/107746 여기를 참고하는 것이 좋다.



##### 참고한, 참고할만한사이트

https://namu.wiki/w/CPU%EA%B2%8C%EC%9D%B4%ED%8A%B8#s-3.2

http://news.donga.com/3/all/20180104/88026760/1

https://steemit.com/coinkorea/@coinkorea/cpu