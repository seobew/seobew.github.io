## DB Normalization이란?



### 정의

데이터베이스 정규화는 관계형 데이터베이스 설계 단계에서 데이터의 중복을 최소화 하기 위해서 데이터를 구조화 하는 작업이다. 예를 들면 크고 제대로 조직되지 않은 테이블들 간의 관계를 작고 잘 조직된 것으로 변경하는 것이다. 정규화를 통해 불필요한 데이터(redundancy)를 없앨 수 있고, 삽입/갱신/삭제 시 발생할 수 있는 각종 이종현상(Anomolies)들을 방지 할 수 있습니다. 

종류는 1NF부터 6NF, BCNF가 있으며, 보통 3NF가 되었으면 **'정규화 되었다'**라고 한다.

### 정규화 방법

높은 차수의 정규형은 낮은 차수의 정규형을 모두 만족해야한다. ( => 3정규형은 제 1,2 정규형의 조건을 모두 만족하여한다.) BCNF(1,2,3 다음인)는 1,2,3 정규형을 기본적으로 모두 만족하고 있어야한다. 

> NF : Normal Form

#### 제1 정규형(1NF)

* 중복되는 항목이 없어야 한다. (도메인이 원자값으로 되어 있어야함)

예를 들어 보면,

<img src="http://cfile6.uf.tistory.com/image/2508FC4758DD259E21EFC3">

위와 같이 설계시, 고객이 전화번호 2개 이상일 때, 문제가 생길 수 있다. 그렇다고 똑같은 사람의 클라이언트의 전화번호가 다른 row를 추가하면 제 1정규형을 만족하지 않는다. 그래서 아래와 같이 해결을 해볼 수 있겠는데,

<img src="http://cfile10.uf.tistory.com/image/26136A4C58DD26701734E2">

이렇게 되면 또다른 문제들에 봉착할 수 있다.

- 갯수 문제 : 어떤 고객이 4개 이상의 전화번호를 가지고 있다면? (~~물론 이렇게 가질 경우는 드물다.~~)
- 테이블 질의(쿼리) 문제 : 어떤 고객이 555-403-1659 전화번호를 가지고 있는가?->Tel.No.1,2,3 중에서 어떻게 검색을 해야할까?
- 고객-전화번호 간의 유일성 확보 문제 : 456 고객의 전화번호 2개가 중복으로 들어가 있음?

이런 문제들을 해결하려면, 아래와 같이 다른 테이블을 만들어서 관계를 지어주면 된다. 

<img src="http://cfile29.uf.tistory.com/image/2577694C58DD28990D6360">

#### 제2 정규형(2NF)

- 부분 함수적 종속 관계를 제거해야 한다.

<img src="http://cfile4.uf.tistory.com/image/2449AE4858DD38BC2E846A">

위 테이블에서 후보키는 **''종업원 + 기술''**이다. 하지만 근무지는 종업원에만 종속적이지 기술에도 종속적이진 않다. 

> 키의 일부에만 종속적인 관계를 가지는 것을 부분 함수적 종속관계라고 한다. -> 갱신이상을 현상을 초래할 수 있음

<img src="http://cfile22.uf.tistory.com/image/274E744858DD38BD14067C">

이런식으로 나누어서 정규화를 해야한다!

#### 제3 정규형(3NF)

- 이행 함수적 종속 (x-> y -> z) 제거

<img src="http://cfile23.uf.tistory.com/image/236D584858DD39B8093731">

대회 + 연도를 키로 우승자가 결정되고 우승자에 따라 우승자 생년월일이 결정된다. 이처럼 x->y이고 y->z 인 관계를 이행 함수적 종속이라고 한다. 이런 경우 우승자를 변경하면 불필요하게 우승자 생년월일도 동시에 변경해야해서 갱신이상 현상을 초래할 수 있다. 해결 방법으로는

<img src="http://cfile25.uf.tistory.com/image/2727914858DD39B92939F5">

이런식으로 분리해서 해결한다. 여기까지하면 대부분의 정규화 작업이 끝난다!

#### BCNF(Boyce-codd)

- 결정자이면서 후보키가 아닌 것 제거 // 테이블에 존재하는 모든 함수 종속 관계의 determinant가 후보키이면 BCNF라고 한다.

3차 정규형을 조금 더 강화한 버전으로 볼 수 있다. 즉, 모든 결정자가 후보키 집합에 속한 정규형이다. 3차 정규형을 만족하면서 BCNF는 만족하지 않는 경우는 **일반 컬럼이 후보키를 결정**하는 경우이다. 

|  학생  |  과목   |   교수   |  학점  |
| :--: | :---: | :----: | :--: |
|  1   | AB123 |  김인영   |  A   |
|  2   | CS123 | Mr.Sim |  A   |
|  3   | CS123 | Mr.Sim |  A   |

위 예시에서는 (학생, 과목)이고, 유일하게 구분 할 수 있습니다. 근데 이 테이블의 경우 교수가 **결정자**이다. (교수가 한 과목만 강의할 수 있다고 가정) => 교수가 정해지면 과목이 결정된다. 하지만 교수는 후보키가 아니다. (교수로 인해서 row들이 구분되어지지 않음) 따라서 BCNF를 만족하지 못한다. 

위와 같이 테이블이 구성된 경우에 데이터가 중복되고, 갱신 이상이 발생한다. 예를 들어, Mr.Sim이 강의하는 과목명이 바뀌었다면 두 개의 로우를 갱신해야한다. -> 이걸 해결하기 위해서는 마찬가지로 테이블을 분리해야한다.

|   교수   |  과목   |
| :----: | :---: |
|  김인영   | AB123 |
| Mr.Sim | CS123 |

|  학생  |   교수   |  학점  |
| :--: | :----: | :--: |
|  1   |  김인영   |  A   |
|  2   | Mr.Sim |  A   |
|  3   | Mr.Sim |  A   |

#### 추가로 같이 알면 좋을 것

속도를 위해서 정규화를 풀기도 함!

#### 다음시간에 더 할 것

제 4정규형, 제 5정규형

##### 참고한, 참고할만한사이트

https://blog.lael.be/post/71

http://untitledtblog.tistory.com/128

http://gomcine.tistory.com/entry/Database-9-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4-%EC%A0%95%EA%B7%9C%ED%99%94-%EA%B0%9C%EB%85%90-%EB%B0%8F-%EB%B0%A9%EB%B2%95

http://3months.tistory.com/193